<template>
  <div id="container"></div>
</template>

<script>
export default {
  data() {
    return {
      map: null,
      pathData: [
        {"aLong":33.96479318,	"aLat":118.2756473,	"bLong":33.96479412, "bLat":118.275628,	"cLong":33.96473789,"cLat":118.2756454,"dLong":33.96473916,"dLat":118.2756197},
        {"aLong":33.96473789,	"aLat":118.2756454,	"bLong":33.96473916,"bLat":118.2756197,"cLong":33.96468162,"cLat":118.2756325,"dLong":33.96468393,"dLat":118.2756142},
        {"aLong":33.96468162,	"aLat":118.2756325,	"bLong":33.96468393,	"bLat":118.2756142,	"cLong":33.96462168,	"cLat":118.2756264,"dLong":33.96462348,"dLat":	118.275607},
        {"aLong":33.96462168,	"aLat":118.2756264,	"bLong":33.96462348,	"bLat":118.275607,	"cLong":33.964565,	  "cLat":118.2756211,"dLong":33.96456758,"dLat":	118.2756016},
        {"aLong":33.964565,	  "aLat":118.2756211,	"bLong":33.96456758,	"bLat":118.2756016,	"cLong":33.96450809,	"cLat":118.275615,"dLong":33.96450893,"dLat":	118.275596},
        {"aLong":33.96450809,	"aLat":118.275615,	"bLong":33.96450893,	"bLat":118.275596,	"cLong":33.96444898,	"cLat":118.2756082,"dLong":33.96445084,"dLat":	118.2755895},
        {"aLong":33.96444898,	"aLat":118.2756082,	"bLong":33.96445084,	"bLat":118.2755895,	"cLong":33.96439272,	"cLat":118.2756009,"dLong":33.96439401,"dLat":	118.2755835},
        {"aLong":33.96439272,	"aLat":118.2756009,	"bLong":33.96439401,	"bLat":118.2755835,	"cLong":33.96433064,	"cLat":118.2755975,"dLong":33.96432733,"dLat":	118.2755813},
        {"aLong":33.96433064,	"aLat":118.2755975,	"bLong":33.96432733,	"bLat":118.2755813,	"cLong":33.96426762,	"cLat":118.275596,"dLong":33.96427007,"dLat":	118.2755778},
        {"aLong":33.96426762,	"aLat":118.275596,	"bLong":33.96427007,	"bLat":118.2755778,	"cLong":33.96421199,	"cLat":118.2755879,"dLong":33.96421078,"dLat":	118.275564},
        {"aLong":33.96421199,	"aLat":118.2755879,	"bLong":33.96421078,	"bLat":118.275564,	"cLong":33.96415372,	"cLat":118.2755793,"dLong":33.96415487,"dLat":	118.2755602},
        {"aLong":33.96415372,	"aLat":118.2755793,	"bLong":33.96415487,	"bLat":118.2755602,	"cLong":33.96409576,	"cLat":118.2755739,"dLong":33.96409673,"dLat":	118.2755542},
        {"aLong":33.96409576,	"aLat":118.2755739,	"bLong":33.96409673,	"bLat":118.2755542,	"cLong":33.96403602,	"cLat":118.275568,"dLong":33.96403952,"dLat":	118.2755478},
        {"aLong":33.96403602,	"aLat":118.275568,	"bLong":33.96403952,	"bLat":118.2755478,	"cLong":33.96397873,	"cLat":118.2755614,"dLong":33.96397976,"dLat":	118.2755425},
        {"aLong":33.96397873,	"aLat":118.2755614,	"bLong":33.96397976,	"bLat":118.2755425,	"cLong":33.96392025,	"cLat":118.2755555,"dLong":33.96392127,"dLat":	118.2755366},
        {"aLong":33.96392025,	"aLat":118.2755555,	"bLong":33.96392127,	"bLat":118.2755366,	"cLong":33.96385797,	"cLat":118.2755488,"dLong":33.96385921,"dLat":	118.2755295},
        {"aLong":33.96385797,	"aLat":118.2755488,	"bLong":33.96385921,	"bLat":118.2755295,	"cLong":33.96379704,	"cLat":118.2755431,"dLong":33.96379857,"dLat":	118.2755242},            
        {"aLong":33.96297974,	"aLat":118.2755214,	"bLong":33.96297841,	"bLat":118.275541,	"cLong":33.96303938,	"cLat":118.2755275,"dLong":33.96303706,"dLat":	118.2755466},
        {"aLong":33.96303938,	"aLat":118.2755275,	"bLong":33.96303706,	"bLat":118.2755466,	"cLong":33.9630934,	"cLat":118.2755332,"dLong":33.96309233,"dLat":	118.2755529},
        {"aLong":33.9630934,	"aLat":118.2755332,	"bLong":33.96309233,	"bLat":118.2755529,	"cLong":33.9631521,	"cLat":118.2755389,"dLong":33.96314995,"dLat":	118.2755602},
        {"aLong":33.9631521,	"aLat":118.2755389,	"bLong":33.96314995,	"bLat":118.2755602,	"cLong":33.96321026,	"cLat":118.275545,"dLong":33.96320924	,"dLat":118.2755637},
        {"aLong":33.96321026,	"aLat":118.275545,	"bLong":33.96320924,	"bLat":118.2755637,	"cLong":33.96326916,	"cLat":118.2755506,"dLong":33.96326794,"dLat":	118.2755704},
        {"aLong":33.96326916,	"aLat":118.2755506,	"bLong":33.96326794,	"bLat":118.2755704,	"cLong":33.96332832,	"cLat":118.2755565,"dLong":33.96332732,"dLat":	118.2755764},
        {"aLong":33.96332832,	"aLat":118.2755565,	"bLong":33.96332732,	"bLat":118.2755764,	"cLong":33.9633883,	"cLat":118.275562,"dLong":33.9633869,"dLat":	118.2755814},
        {"aLong":33.9633883,	"aLat":118.275562,	"bLong":33.9633869,	  "bLat":118.2755814,	"cLong":33.96344553,	"cLat":118.2755681,"dLong":33.96344478,"dLat":	118.2755876},
        {"aLong":33.96344553,	"aLat":118.2755681,	"bLong":33.96344478,	"bLat":118.2755876,	"cLong":33.96350142,	"cLat":118.2755733,"dLong":33.9635003,"dLat":	118.2755934},
        {"aLong":33.96350142,	"aLat":118.2755733,	"bLong":33.9635003,	  "bLat":118.2755934,	"cLong":33.96355722,	"cLat":118.2755797,"dLong":33.96355767,"dLat":	118.2755993},
        {"aLong":33.96355722,	"aLat":118.2755797,	"bLong":33.96355767,	"bLat":118.2755993,	"cLong":33.96360858,	"cLat":118.2755847,"dLong":33.96360749,"dLat":	118.2756018}
      ],
      linesData: [
        [118.2756654,	33.9649191 ],
        [118.275665,	33.96489442],
        [118.275664,	33.96486787],
        [118.2756621,	33.96484171],
        [118.2756595,	33.96481278],
        [118.2756556,	33.96477892],
        [118.2756521,	33.96474737],
        [118.275649,	33.96471751],
        [118.2756452,	33.96468621],
        [118.2756418,	33.96465427],
        [118.2756387,	33.96462005],
        [118.2756356,	33.96458777],
        [118.2756327,	33.96455652],
        [118.2756292,	33.96452209],
        [118.2756254,	33.96448736],
        [118.2756212,	33.96445261],
        [118.2756173,	33.96441834],
        [118.2756138,	33.96438392],
        [118.2756102,	33.96434933],
        [118.2756073,	33.96432196],
        [118.2756061,	33.96431403],
        [118.2756019,	33.96427746],
        [118.2755984,	33.96424069],
        [118.2755957,	33.96421131],
        [118.2755948,	33.96420284],
        [118.2755909,	33.96416435],
        [118.2755873,	33.9641279],
        [118.2755834,	33.96408687],
        [118.2755796,	33.96404797],
        [118.2755765,	33.96400814],
        [118.2755723,	33.96396767],
        [118.2755676,	33.96392712],
        [118.2755629,	33.96388699],
        [118.2755583,	33.96384703],
        [118.275554,	33.96381108],
        [118.2755484,	33.96377054],
        [118.2755429,	33.96373152],
        [118.2755376,	33.96369419],
        [118.2755324,	33.96365627],
        [118.2755277,	33.96361866],
        [118.2755229,	33.96357962],
        [118.2755176,	33.96353998],
        [118.2755131,	33.96349997],
        [118.275508,	33.9634607],
        [118.2755034,	33.96342193],
        [118.2754987,	33.96338362],
        [118.2754941,	33.96334387],
        [118.275493,  33.96330675],
        [118.2754861,	33.96327099],
        [118.275482,	33.96323601],
        [118.2754773,	33.9632003],
        [118.2754731,	33.96316452],
        [118.2754692,	33.96313003],
        [118.2754688,	33.96312623],
        [118.2754655,	33.96309612],
        [118.2754619,	33.96306223],
        [118.2754585,	33.96302861],
        [118.275455,	33.96299464],
        [118.2754517,	33.96296095],
        [118.2754482,	33.96292751],
        [118.2754447,	33.96289366],
        [118.2754406,	33.96285681],
        [118.2754366,	33.96282162],
        [118.2754327,	33.9627871],
        [118.275427,	33.96275473],
        [118.2754197,	33.96272826],
        [118.2754197,	33.96270959],
        [118.2754267,	33.96269708],
        [118.2754381,	33.96268845],
        [118.2754573,	33.96268345],
        [118.275478,	33.96268708],
        [118.2754935,	33.96269832],
        [118.2755024,	33.96271553],
        [118.2755053,	33.96273721],
        [118.2755048,	33.96276119],
        [118.2755035,	33.96278748],
        [118.2755027,	33.96281456],
        [118.2755035,	33.96284265],
        [118.2755051,	33.96287009],
        [118.2755056,	33.96287915],
        [118.2755066,	33.96289678],
        [118.2755078,	33.96292405],
        [118.2755091,	33.96295159],
        [118.2755099,	33.96296373],
        [118.2755113,	33.96297884],
        [118.2755139,	33.96300537],
        [118.2755165,	33.96303205],
        [118.2755185,	33.9630594],
        [118.2755207,	33.96308676],
        [118.2755234,	33.96311446],
        [118.2755266,	33.96314311],
        [118.275531,	33.9631727],
        [118.2755344,	33.96320291],
        [118.2755378,	33.96323522],
        [118.2755408,	33.96326609],
        [118.2755437,	33.96329866],
        [118.2755468,	33.96333527],
        [118.2755496,	33.96337308],
        [118.2755529,	33.96341028],
        [118.2755579,	33.9634477],
        [118.2755626,	33.96348539],
        [118.2755672,	33.96352323],
        [118.2755708,	33.96356111],
        [118.2755736,	33.96359745],
        [118.2755772,	33.96363488],
        [118.2755815,	33.9636706],
        [118.2755883,	33.96370717],
        [118.2755977,	33.96374151],
        [118.2756072,	33.96377466],
        [118.2756132,	33.96380626],
        [118.2756166,	33.96383344],
        [118.2756194,	33.96385175],
        [118.2756204,	33.9638603],
        [118.2756206,	33.96386336],
        [118.275621,	33.96386936],
        [118.2756212,	33.96387189],
        [118.2756212,	33.96387195],
        [118.2756213,	33.96387201],
        [118.2756213,	33.96387198],
        [118.2756214,	33.96387198],
        [118.2756213,	33.96387199],
        [118.2756214,	33.96387202],
        [118.2756213,	33.96387202],
        [118.2756214,	33.96387201],
        [118.2756214,	33.963872],
        [118.2756214,	33.96387199],
        [118.2756214,	33.96387198],
        [118.2756214,	33.96387199],
        [118.2756214,	33.96387201],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387203],
        [118.2756213,	33.96387202],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387205],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387205],
        [118.2756214,	33.96387206],
        [118.2756214,	33.96387205],
        [118.2756214,	33.96387204],
        [118.2756213,	33.96387204],
        [118.2756213,	33.96387204],
        [118.2756213,	33.96387202],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387202],
        [118.2756213,	33.96387202],
        [118.2756213,	33.96387201],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387203],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387204],
        [118.2756214,	33.96387206],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387201],
        [118.2756214,	33.96387201],
        [118.2756214,	33.96387201],
        [118.2756214,	33.96387202],
        [118.2756215,	33.96387202],
        [118.2756214,	33.96387202],
        [118.2756214,	33.96387202]
      ]
    }
  },
  methods: {
    async initMap () {
      let map = new AMap.Map("container", {
        resizeEnable: true,
        center: [118.275162,33.963008], //中心点坐标
        zoom: 18, //级别
        expandZoomRange:true,
        zooms:[3,20]
      });
      let polygons = []

      let berths = this.pathData;
      for (let i = 0; i < berths.length; i++) {
        let berth = berths[i]
        let path = [
          [berth.aLat,berth.aLong],
          [berth.bLat,berth.bLong],
          [berth.dLat,berth.dLong],
          [berth.cLat,berth.cLong],
        ]
        // console.log(path,"path")
        // const polygon = await this.convertFromPolygon(path)
        const polygon = await this.convertFromPolygon(path)
        polygons.push(polygon)
      }

      
      let lineArr = this.linesData
      let lineArrs = []
      const currentLocation = await this.convertFrom(lineArr)
      console.log(currentLocation)
      for (let i = 0; i < currentLocation.length; i++) {
        lineArrs.push([
          currentLocation[i].lng, currentLocation[i].lat
        ])
      }
   
      var marker = new AMap.Polyline({
          // path: this.linesData,
          path:  lineArrs,
          // map: map,
          // borderWeight: 2, // 线条宽度，默认为 1
          strokeColor: 'red', // 线条颜色
          // lineJoin: 'round' // 折线拐点连接处样式
        strokeOpacity: 0.5,     //线透明度
        strokeWeight: 2,   
      });
      map.add(marker)
      map.add(polygons)
      map.setFitView() 
    },


    async convertFromPolygon(path) {
      // console.log(1)
      const convertPath = await this.convertFrom(path)
      const polygon = new AMap.Polygon({
        path: convertPath,
        // path: path,
        strokeColor: "#FF33FF",
        strokeWeight: 1,
        strokeOpacity: 0.2,
        fillOpacity: 0.4,
        fillColor: '#1791fc',
        // zIndex: 50
      })
      return polygon
    },

    // gps转高德坐标
     convertFrom (path){
      return new Promise((resolve, reject) => {
        AMap.convertFrom(path, 'gps', (status, result) => {
          if (result.info === 'ok') {
            const convertPath = result.locations
            // console.log(convertPath)
            resolve(convertPath)
          }
        })
      })
    },



    destroyMap() {
      this.map && this.map.destroy();
    },
  },
  mounted() {
    this.initMap();
  },
  destroyed() {
    this.destroyMap();
  },
}
</script>

<style lang="scss">
#container {
  width: 100%;
  height: 100vh;
  margin-bottom: 50px;
}

</style>